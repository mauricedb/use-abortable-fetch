import{useState as t,useRef as r,useLayoutEffect as n,useEffect as o}from"react";import e from"media-typer";import a from"content-type";function l(){return(l=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}export default(i,s)=>{const[u,c]=t({data:null,loading:0,error:null,controller:null}),f=r(!1);return n(()=>(f.current=!0,()=>{f.current=!1}),[]),o(()=>{const t=new AbortController;return i&&(async(t,r={},n,o)=>{const i=l({},r,{signal:n.signal});let s=null;try{o(t=>({data:null,loading:t.loading+1,error:null,controller:n})),s=await fetch(t,i);const r=s.headers.get("content-type");if(r){let t=null;t=function(t){if(t){const r=a.parse(t),n=e.parse(r.type);if("json"===n.subtype)return!0;if("json"===n.suffix)return!0;if(n.suffix&&/\bjson\b/i.test(n.suffix))return!0;if(n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}(r)?await s.json():await s.text(),o(r=>l({},r,{data:t,loading:r.loading-1}))}else o(t=>l({},t,{loading:t.loading-1}));if(!s.ok){const t=new Error(s.statusText);throw t.status=s.status,t}}catch(t){const r=t,n="AbortError"!==r.name?r:null;o(t=>l({},t,{error:n,loading:s?t.loading:t.loading-1}))}})(i,s,t,t=>{f.current&&c(t)}),()=>t.abort()},[s,i]),{data:u.data,loading:!!u.loading,error:u.error,abort:()=>u.controller&&u.controller.abort()}};
//# sourceMappingURL=index.modern.js.map
